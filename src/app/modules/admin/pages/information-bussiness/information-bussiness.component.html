<app-banner
  title="{{ 'DASHBOARD.BUSINESS' | translate }}"
  img="/assets/img/banners/banner-dashboard-pc.jpg"
  imgMobile="/assets/img/banners/banner-dashboard-mobile.jpg"
></app-banner>
<div class="container mt-3">
  <div fxLayout="row" fxLayoutAlign="space-between center">
    <div fxLayout="row">
      <img class="image-bussiness" [src]="image" alt="" />
      <span>
        <h3>{{ title }} / Información</h3></span
      >
    </div>
    <span fxLayout="row">
      <button
        mat-raised-button
        class="back-button"
        [routerLink]="['/negocios-admin']"
      >
        <span
          class="galano-bold f-16"
          fxLayout="row"
          fxLayoutAlign="start center"
        >
          <mat-icon>keyboard_arrow_left</mat-icon>
          {{ "BUTTONS.BACK" | translate }}
        </span>
      </button>
    </span>
  </div>
  <div>
    
    <mat-tab-group>

      <mat-tab>
        <ng-template mat-tab-label>
          <span class="gtmgeneral">General</span>
        </ng-template>
        <app-form-business [dataBusiness]="businessdata"></app-form-business>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          <span class="gtmTerminosCondicionesClicTerminosLegales">Sobre el negocio</span>
        </ng-template>
        <div class="mt-3">
          <mat-card style="width: 800px">
            <h3>SOBRE EL NEGOCIO</h3>
            <form [formGroup]="aboutBuss">
              <mat-form-field style="width: 755px">
                <textarea
                  matInput
                  placeholder="SOBRE EL NEGOCIO"
                  type="text"
                  required
                  formControlName="aboutBuss"
                  class="text-area-heigth"
                  style="height: 160px; color: #37236a"
                ></textarea>
                <mat-error id="requiredName" *ngIf="aboutBuss.controls.aboutBuss.invalid && aboutBuss.controls.aboutBuss.errors.required">{{
                  'GENERIC.REQUIRED' | translate: { formValue: 'Sobre el negocio' }
                }}</mat-error>
                <mat-error id="maxName" *ngIf="aboutBuss.controls.aboutBuss.invalid && aboutBuss.controls.aboutBuss.errors.maxlength">{{
                  'GENERIC.MAX_CHARACTERS'
                    | translate
                      : {
                          maxchar: aboutBuss.controls.aboutBuss.errors.maxlength.requiredLength
                        }
                }}</mat-error>
                <mat-error id="invalidName" *ngIf="aboutBuss.controls.aboutBuss.invalid && aboutBuss.controls.aboutBuss.errors.pattern">{{
                  'GENERIC.INVALID_FORMAT' | translate: { val: 'Sobre el negocio' }
                }}</mat-error>
                <mat-error id="minPhone" *ngIf="aboutBuss.controls.aboutBuss.invalid && aboutBuss.controls.aboutBuss.errors.minlength">{{
                  'GENERIC.MIN_CHARACTERS'
                    | translate
                      : {
                          minchar: aboutBuss.controls.aboutBuss.errors.minlength.requiredLength
                        }
                }}</mat-error>
              </mat-form-field>
            </form>
            <div fxLayout="row" fxLayoutAlign="end end">
              <button mat-button ngClass="button_cancel" [routerLink]="['/negocios-admin']">Descartar Cambios</button>
              <button
                mat-raised-button
                color="orange"
                (click)="addAboutBussiness()"
                id="download-users"
                class="ml-2"
                [disabled]="!aboutBuss.valid"
              >
                Guardar Cambios
              </button>
            </div>
          </mat-card>
        </div>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span class="gtmTerminosCondicionesClicTerminosLegales">Términos & Condiciones</span>
        </ng-template>
        <div class="mt-3">
          <mat-card style="width: 800px">
            <h3>TÉRMINOS & CONDICIONES</h3>
            <form [formGroup]="termsData">
              <mat-form-field style="width: 755px">
                <textarea
                  matInput
                  placeholder="EXCEPCIONES"
                  type="text"
                  required
                  class="text-area-heigth"
                  formControlName="general"
                  style="height: 160px; color: #37236a"
                ></textarea>
                <mat-error id="requiredName" *ngIf="termsData.controls.general.invalid && termsData.controls.general.errors.required">{{
                  'GENERIC.REQUIRED' | translate: { formValue: 'Excepciones' }
                }}</mat-error>
              </mat-form-field>
              <mat-form-field style="width: 755px">
                <textarea
                  matInput
                  placeholder="CASOS ESPECIALES"
                  type="text"
                  required
                  formControlName="exceptions"
                  class="text-area-heigth"
                  style="height: 160px; color: #37236a"
                ></textarea>
                <mat-error
                  id="requiredName"
                  *ngIf="termsData.controls.exceptions.invalid && termsData.controls.exceptions.errors.required"
                  >{{ 'GENERIC.REQUIRED' | translate: { formValue: 'Casos especiales' } }}</mat-error
                >
              </mat-form-field>
              <mat-form-field style="width: 755px">
                <textarea
                  matInput
                  placeholder="TIEMPOS DE VERIFICACIÓN"
                  type="text"
                  required
                  formControlName="caseSpecial"
                  class="text-area-heigth"
                  style="height: 160px; color: #37236a"
                ></textarea>
                <mat-error
                  id="requiredName"
                  *ngIf="termsData.controls.caseSpecial.invalid && termsData.controls.caseSpecial.errors.required"
                  >{{ 'GENERIC.REQUIRED' | translate: { formValue: 'Tiempos de verificación' } }}</mat-error
                >
              </mat-form-field>
            </form>
            <div fxLayout="row" fxLayoutAlign="end end">
              <button mat-button ngClass="button_cancel" [routerLink]="['/negocios-admin']">Descartar Cambios</button>
              <button
                mat-raised-button
                color="orange"
                (click)="addTermsConditions()"
                id="download-users"
                [disabled]="!termsData.valid"
                class="ml-2"
              >
                Guardar Cambios
              </button>
            </div>
          </mat-card>
        </div>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span class="gtmTerminosCondicionesClicTerminosLegales">Tips de venta</span>
        </ng-template>
        <div class="mt-3">
          <h3>TIPS DE VENTA</h3>
          <table
            mat-table
            #table
            class="mat-elevation-z2"
            [dataSource]="dataSource"
            cdkDropList
            [cdkDropListData]="dataSource"
            (cdkDropListDropped)="dropTable($event)"
          >
            <ng-container matColumnDef="drag">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let element; let i = index">
                <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign.gt-xs="end center" fxLayoutAlign.xs="center center">
                  <mat-icon matSuffix class="mr-1 blue cursor-pointer" cdkDragHandle>drag_indicator</mat-icon>
                </div>
              </td>
            </ng-container>
            <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef style="width: 20%; font-weight: bold">TÍTULO</th>
              <td mat-cell *matCellDef="let element">
                <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign.gt-xs="start center" fxLayoutAlign.xs="center center">
                  <span fxLayout="column" class="f-14 mr-2" fxHide.xs="true">
                    {{ element.title }}
                  </span>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="description">
              <th mat-header-cell class="tr" *matHeaderCellDef style="width: 70%; font-weight: bold">DESCRIPCIÓN</th>
              <td mat-cell *matCellDef="let element; let i = index">
                <div fxLayout="row" fxLayoutGap="10px">
                  <span fxLayout="column" class="f-14" fxHide.xs="true">
                    {{ element.description }}
                  </span>
                </div>
              </td>
            </ng-container>
            <ng-container matColumnDef="edition">
              <th mat-header-cell *matHeaderCellDef class="center-text" style="font-weight: bold">ACCIONES</th>
              <td mat-cell *matCellDef="let element; let i = index">
                <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign.gt-xs="center" fxLayoutAlign.xs="center center">
                  <i class="tio-edit style-icon cursor-pointer" (click)="editTipModal(element)"></i>

                  <img class="cursor-pointer" (click)="deleteTip(element)" src="/assets/img/dashboard/icon-remove-comision.svg" alt="" />
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns; let i = index" cdkDrag [cdkDragData]="row"></tr>
          </table>
          <div class="mt-3 mb-3" fxLayout="row" fxLayoutAlign="end end">
            <button mat-raised-button color="orange" (click)="addTip()" id="download-users" class="ml-2">Agregar Tip</button>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
<ng-template #templateAddTips>
  <div ngClass="delete-container">
    <div>
      <form [formGroup]="dataTip">
        <mat-form-field style="width: 370px">
          <input
            matInput
            placeholder="TÍTULO"
            formControlName="title"
            type="text"
            required
            class="text-area-heigth"
            style="color: #37236a"
          />
          <mat-error id="requiredName" *ngIf="dataTip.controls.title.invalid && dataTip.controls.title.errors.required">{{
            'GENERIC.REQUIRED' | translate: { formValue: 'Título' }
          }}</mat-error>
        </mat-form-field>
        <mat-form-field style="width: 370px">
          <textarea
            matInput
            placeholder="DESCRIPCIÓN"
            type="text"
            formControlName="description"
            required
            class="text-area-heigth"
            style="height: 145px; color: #37236a"
          ></textarea>
          <mat-error id="requiredName" *ngIf="dataTip.controls.description.invalid && dataTip.controls.description.errors.required">{{
            'GENERIC.REQUIRED' | translate: { formValue: 'Descripción' }
          }}</mat-error>
        </mat-form-field>
      </form>
    </div>

    <div fxLayout="row" fxLayoutAlign="end end">
      <button mat-button ngClass="button_cancel" (click)="onNoClick()">Cancelar</button>
      <button mat-raised-button color="orange" (click)="saveTip()" id="download-users" class="ml-2" [disabled]="!dataTip.valid">
        Guardar
      </button>
    </div>
  </div>
</ng-template>

<ng-template #templateEditTips>
  <div ngClass="delete-container">
    <div>
      <form [formGroup]="dataEditTip">
        <mat-form-field style="width: 370px">
          <input
            matInput
            placeholder="TÍTULO"
            formControlName="title"
            type="text"
            required
            class="text-area-heigth"
            style="color: #37236a"
          />
          <mat-error id="requiredName" *ngIf="dataEditTip.controls.title.invalid && dataEditTip.controls.title.errors.required">{{
            'GENERIC.REQUIRED' | translate: { formValue: 'Descripción' }
          }}</mat-error>
        </mat-form-field>
        <mat-form-field style="width: 370px">
          <textarea
            matInput
            placeholder="DESCRIPCIÓN"
            type="text"
            formControlName="description"
            required
            class="text-area-heigth"
            style="height: 145px; color: #37236a"
          ></textarea>
          <mat-error
            id="requiredName"
            *ngIf="dataEditTip.controls.description.invalid && dataEditTip.controls.description.errors.required"
            >{{ 'GENERIC.REQUIRED' | translate: { formValue: 'Descripción' } }}</mat-error
          >
        </mat-form-field>
      </form>
    </div>

    <div fxLayout="row" fxLayoutAlign="end end">
      <button mat-button ngClass="button_cancel" (click)="onNoClick()">Cancelar</button>
      <button mat-raised-button color="orange" (click)="editTip()" id="download-users" class="ml-2" [disabled]="!dataEditTip.valid">
        Guardar
      </button>
    </div>
  </div>
</ng-template>

<app-banner
  title="{{ 'USERS.USERS' | translate }}"
  img="/assets/img/banners/banner-dashboard-pc.jpg"
  imgMobile="/assets/img/banners/banner-dashboard-mobile.jpg"
></app-banner>

<div class="container m-t4 fade-in">
  <div fxLayout="row" fxLayoutAlign="space-between center">
    <div>

      <button mat-raised-button color="orange" (click)="openModalFilters(false)" id="download-users">
        Ordenar y filtrar
        <i class="tio-filter style-icon"></i>
      </button>

      <button mat-raised-button color="orange" (click)="exportUsersFilter()" id="download-users" class="ml-2 mr-2">
        Exportar
        <i class="tio-download_from_cloud style-icon"></i>
      </button>
      <span class="mx-2 br-gray" ></span>
      <button mat-raised-button color="orange" (click)="openModalFilters(true)" id="download-users" class="ml-2">
        Exportar filtros usuario
        <i class="tio-download_from_cloud style-icon"></i>
      </button>

    </div>

    <div class="container-search mt-2">
      <app-search-users class="searchUser" (search)="searchUser($event)"></app-search-users>
    </div>
  </div>

  <div id="users-table">
    <app-table-users
      (dataUser)="userData($event)"
      (dataEmail)="userEmail($event)"
      [(dataSource)]="dataSource"
      (sortDataUser)="sort($event)"
      [size]="pageSize"
      [p]="pageIndex"
      [totalItems]="totalItems"
    ></app-table-users>

    <pagination-template #p="paginationApi" (pageChange)="pagination($event)">
      <div fxLayout="row" fxLayoutGap="12px" class="paginator" fxLayoutAlign="end center">
        <span class="items">Items por p√°gina {{ pageSize }}</span>
        <div class="pagination-previous" [class.disabled]="p.isFirstPage()">
          <a (click)="p.previous()"> <i class="tio-back_ui"></i> </a>
        </div>

        <div class="bubble" fxLayout="row" fxLayoutGap="20px" fxLayoutAlign="space-between center">
          <div *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value">
            <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value">
              <span class="cursor-pointer">{{ page.label }}</span>
            </a>
            <div *ngIf="p.getCurrent() === page.value">
              <span class="cursor-pointer">{{ page.label }}</span>
            </div>
          </div>
        </div>

        <div class="pagination-next" [class.disabled]="p.isLastPage()">
          <a (click)="p.next()"> <i class="tio-next_ui"></i> </a>
        </div>
      </div>
    </pagination-template>
  </div>

  <p class="title-blue mt-4 border-bottom-gray pb-3">DESCARGAR REPORTE DE USUARIOS</p>
  <div class="mt-4 container-forms" fxLayout="row">
    <div class="ml-4 downloadUsers user-transactions">
      <form [formGroup]="dateForm">
        <mat-form-field class="selected-report">
          <mat-placeholder class="selected-placeholder">TIPO DE REPORTE</mat-placeholder>
          <mat-select id="tipoReport" formControlName="tipoReport" class="selected-report">
            <mat-option (click)="onChangeSelected(selected.titulo)" *ngFor="let selected of selecteds" value="{{ selected.value }}">
              <span>{{ selected.titulo }}</span>
            </mat-option>
          </mat-select>
        </mat-form-field>
        <i [hidden]="dateNoVisible" class="tio-date_range icon-date"></i>
        <input
          [hidden]="dateNoVisible"
          (change)="change()"
          formControlName="dateRange"
          [locale]="locale"
          placeholder="Seleccione fechas"
          type="text"
          [maxDate]="maxDate"
          drops="up"
          ngxDaterangepickerMd
          [showDropdowns]="true"
          class="form-control border-input mat-elevation-z1 p-2 border-radius"
        />
        <button mat-raised-button color="orange" (click)="getAnyReport()" id="download-users" class="ml-2" [disabled]="disableButon">
          Exportar
          <i class="tio-download_from_cloud style-icon"></i>
        </button>
      </form>
    </div>
  </div>
</div>

<!-- template filter-->

<ng-template #templateDialogFilter>
  <app-dialog-filter-users [filter]="filter" (objectSend)="infoFilter($event)" (close)="onNoClick()"></app-dialog-filter-users>
</ng-template>

<!-- template Email-->

<ng-template #templateDialogEmail>
  <form [formGroup]="emailForm" fxLayout="column" fxFlex="100" class="formw">
    <mat-form-field>
      <input matInput id="email" type="email" placeholder="{{ 'GENERIC.EMAIL' | translate }}" formControlName="email" spacebar required />
      <span matPrefix><mat-icon color="gray">person</mat-icon></span>
      <mat-error id="introduceEmail" *ngIf="emailForm.controls.email.invalid && emailForm.controls.email.errors.required">{{
        'LOGIN.INTRODUCE_EMAIL' | translate
      }}</mat-error>
      <mat-error id="invalidEmail" *ngIf="emailForm.controls.email.invalid && emailForm.controls.email.errors.pattern">{{
        'LOGIN.INVALID_EMAIL' | translate
      }}</mat-error>
    </mat-form-field>
    <button
      mat-raised-button
      id="editProfile"
      class="center button button-100 mt-4"
      color="orange"
      (click)="changeEmail()"
      [disabled]="!emailForm.valid"
    >
      {{ 'GENERIC.SAVE' | translate }}
    </button>
  </form>
</ng-template>

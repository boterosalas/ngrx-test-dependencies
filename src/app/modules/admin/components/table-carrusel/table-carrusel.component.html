<div class="mat-elevation-z0 mt-4 mb-4">

    <div class="mb-4" fxLayout="row">
        <button mat-raised-button color="orange" (click)="selectAll()" class="button-selected mr-4">
          <img class="icon-download" src="assets/img/dashboard/icon-check.svg" alt="descarga" />
          {{ selectAllVideosImg }}
        </button>
        <button
          mat-raised-button
          (click)="deleteEvery()"
          [ngClass]="active === true ? 'button-selected-red' : 'button-selected-red-disabled'"
          [disabled]="!active"
        >
          <img class="icon-download" src="assets/img/dashboard/icon-trash-red.svg" alt="descarga" />
          Borrar
        </button>
      </div>

    <table
      mat-table
      #table
      [dataSource]="dataSource"
      class="users-table"
      cdkDropList
      [cdkDropListData]="dataSource"
      (cdkDropListDropped)="dropTable($event)"
    >

    <!-- drag Column -->
    <ng-container matColumnDef="drag">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element; let i = index">
          <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign.gt-xs="end center" fxLayoutAlign.xs="center center">
            <mat-icon matSuffix class="mr-1 blue cursor-pointer" cdkDragHandle>drag_indicator</mat-icon>
            <mat-checkbox [(ngModel)]="element.selected" class="check-margin mr-2" (change)="loadDelete()"> </mat-checkbox>
          </div>
        </td>
      </ng-container>

      <!-- image Column -->
      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef>IMAGEN</th>
        <td mat-cell *matCellDef="let element">
          <span fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
            <span fxLayout="column">
                <img
                  class="iconb-bussiness mt-2 mb-2 mr-2 img-business"
                  [src]="element.imageurlweb"
                />
              </span>
          </span>
        </td>
      </ng-container>

      <!-- name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>NOMBRE DE CONTENIDO</th>
        <td mat-cell *matCellDef="let element">
          {{element.description}}
        </td>
      </ng-container>

      <!-- link Column -->
      <ng-container matColumnDef="link">
        <th mat-header-cell *matHeaderCellDef>LINK</th>
        <td mat-cell *matCellDef="let element" class="link" >{{ element.link }}</td>
      </ng-container>

      <!-- business Column -->
      <ng-container matColumnDef="business">
        <th mat-header-cell *matHeaderCellDef>NEGOCIO</th>
        <td mat-cell *matCellDef="let element">{{ element.business }}</td>
      </ng-container>

      <!-- clics Column -->
      <ng-container matColumnDef="clics">
        <th mat-header-cell *matHeaderCellDef>CLICS</th>
        <td mat-cell *matCellDef="let element">{{ element.clicks }}</td>
      </ng-container>

      <!-- clics Column -->
      <ng-container matColumnDef="clicsu">
        <th mat-header-cell *matHeaderCellDef>CLICS ÚNICOS</th>
        <td mat-cell *matCellDef="let element">{{ element.uniqueclicks }}</td>
      </ng-container>

      <!-- video Column -->
      <ng-container matColumnDef="comision">
        <th mat-header-cell *matHeaderCellDef>RECOMPENSA</th>
        <td mat-cell *matCellDef="let element">{{ element.infoaditional }}</td>
      </ng-container>

      <!-- video Column -->
      <ng-container matColumnDef="active">
        <th mat-header-cell *matHeaderCellDef>ACTIVO / INACTIVO</th>
        <td mat-cell *matCellDef="let element">
            <div *ngIf="element.programmed" class="programmed">
                <h4 class="f-12 mb-0 purple2">Programada</h4>
                <p class="f-12 m-0">{{ formatDate(element.datestart) }}</p>
              </div>
              <div *ngIf="!element.programmed && element.undefinedDate" class="programmed">
                <h4 class="f-12 mb-0 purple2">Tiempo indefinido</h4>
              </div>
        </td>
      </ng-container>

      <!-- actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="center-text" style="font-weight: bold">ACCIONES</th>
        <td mat-cell *matCellDef="let element; let i = index">
          <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign.gt-xs="center" fxLayoutAlign.xs="center center">
            <i class="tio-edit style-icon cursor-pointer" (click)="editCarouselModal(element)"></i>
            <img class="cursor-pointer" (click)="deleteCarousel(element)" src="/assets/img/dashboard/icon-remove-comision.svg" alt="" />
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" cdkDrag [cdkDragData]="row"></tr>
    </table>
  
    <div class="mt-3 mb-3" fxLayout="row" fxLayoutAlign="end end">
      <button mat-raised-button color="orange" (click)="saveCarouselModal()" id="download-users" class="ml-2">
        <span fxLayout="row" fxLayoutAlign="start center">
        <i class="tio-upload_on_cloud mr-2"></i>
          Agregar imagen
        </span>
      </button>
    </div>
  </div>


  <ng-template #templateAddImagenCarousel>
    <div ngClass="delete-container">
      <div>
        <form [formGroup]="dataAddImagen">
          <mat-form-field style="width: 370px">
            <input
              matInput
              placeholder="NOMBRE DE CONTENIDO"
              formControlName="nameContent"
              type="text"
              required
              class="text-area-heigth"
              style="color: #37236a"
            />
            <mat-error
              id="requiredName"
              *ngIf="dataAddImagen.controls.nameContent.invalid && dataAddImagen.controls.nameContent.errors.required"
              >{{ 'GENERIC.REQUIRED' | translate: { formValue: 'Nombre de contenido' } }}</mat-error
            >
          </mat-form-field>
          <mat-form-field style="width: 370px">
            <input matInput placeholder="LINK" type="text" formControlName="link" required class="text-area-heigth" style="color: #37236a" />
            <mat-error id="requiredName" *ngIf="dataAddImagen.controls.link.invalid && dataAddImagen.controls.link.errors.required">{{
              'GENERIC.REQUIRED' | translate: { formValue: 'Link' }
            }}</mat-error>
          </mat-form-field>
          <mat-form-field style="width: 370px">
            <mat-label>NEGOCIO</mat-label>
            <select formControlName="business" matNativeControl required>
              <option *ngFor="let selected of selectedBuss" value="{{ selected.id }}">
                <span style="color: #37236a">{{ selected.description }}</span>
              </option>
            </select>
            <mat-error id="requiredName" *ngIf="dataAddImagen.controls.business.invalid && dataAddImagen.controls.business.errors.required">{{
              'GENERIC.REQUIRED' | translate: { formValue: 'Negocio' }
            }}</mat-error>
          </mat-form-field>
  
          <mat-form-field style="width: 370px">
            <input
              matInput
              placeholder="RECOMPENSA"
              type="text"
              formControlName="comision"
              required
              class="text-area-heigth"
              style="color: #37236a"
            />
            <mat-error id="requiredName" *ngIf="dataAddImagen.controls.comision.invalid && dataAddImagen.controls.comision.errors.required">{{
              'GENERIC.REQUIRED' | translate: { formValue: 'Recompensa' }
            }}</mat-error>
          </mat-form-field>
  
          <div fxLayout="row" fxLayoutAlign="space-start center" fxLayoutGap="50px" fxLayoutGap.xs="5px" class="pb-3">
            <div fxLayout="column" fxLayoutAlign="center" class="space">
              <strong class="title-gray" style="color: #a7a3b1; font-size: 11px"
                >ADJUNTAR IMAGEN WEB (1000X561PX, FORMATO .JPG, MAX 300KB)</strong
              >
              <span class="title-secondary" *ngIf="nameFileCert === ''" style="font-size: 11px">No hay archivo seleccionado</span>
              <span class="file-input" *ngIf="nameFileCert !== ''" style="color: #37236a; font-size: 11px">{{
                nameFileCert | truncate: '20'
              }}</span>
            </div>
            <div>
              <label for="image" id="upload" class="cursor-pointer">
                <span *ngIf="!showErrorCert">
                  <img class="mt-1" *ngIf="nameFileCert === ''" src="/assets/img/image-file-upload.svg" alt="upload" />
                  <img class="mt-1" *ngIf="nameFileCert !== ''" src="/assets/img/image-file-upload-ok.svg" alt="upload" />
                </span>
                <img class="mt-1 w-icon" style="width: 30px;" *ngIf="showErrorCert" src="/assets/img/icono-error-carga.svg" alt="upload" />
              </label>
            </div>
          </div>
          <mat-error *ngIf="showErrorCert" class="text-small small pb-2 d-block">
            Formato inválido, sólo se pueden subir archivos con la extensión JPG y menores de 300KB
          </mat-error>
          <input (change)="uploadFileImage($event)" id="image" type="file" style="display: none" formControlName="image" />
          
          <ng-container *ngTemplateOutlet="templatePublication"> </ng-container>

        </form>
      </div>
  
      <div class="mt-3 mb-2" fxLayout="row" fxLayoutAlign="end end">
        <button mat-button ngClass="button_cancel" (click)="onNoClick()">Cancelar</button>
        <button
          mat-raised-button
          color="orange"
          (click)="saveImagenCarousel()"
          id="download-users"
          class="ml-2"
          [disabled]="!dataAddImagen.valid && (!visible) "
        >
          Guardar Cambios
        </button>
      </div>
    </div>
  </ng-template>

  <ng-template #templatePublication>
    <div class="publication">
      <h3 class="secundary-text">PUBLICACIÓN</h3>
      <div class="slide-visible">
        Visible
        <mat-slide-toggle
          [ngModelOptions]="{ standalone: true }"
          [(ngModel)]="visible"
          style="margin-left: 5px; position: relative; top: 2px"
          color="orange2-toggle"
        ></mat-slide-toggle>
      </div>
      <div class="publication-date-range">
        <div class="publication-date">
          <label class="label-up-text mt-2" for="picker"> FECHA DE PUBLICACIÓN </label>
          <div class="mt-2 content-input">
            <mat-datepicker class="icon-date" touchUi #picker></mat-datepicker>
            <mat-datepicker-toggle class="icon-date" matSuffix [for]="picker"></mat-datepicker-toggle>
            <input
              matInput
              (click)="picker.open()"
              [matDatepicker]="picker"
              [min]="maxDate"
              readonly
              (dateChange)="hourChange($event, 'publicationDate')"
              [ngModelOptions]="{ standalone: true }"
              [(ngModel)]="datePublication"
              [disabled]="visible"
              class="border-input mat-elevation-z1 border-radius"
              placeholder="DD/MM/AAAA"
            />
          </div>
        </div>
        <div class="post-time">
          <label class="label-up-text mt-2"> HORA DE PUBLICACIÓN </label>
          <div class="mt-2 content-input">
            <mat-icon *ngIf="!visible" class="tio-watch_later"></mat-icon>
            <mat-icon *ngIf="visible" class="tio-watch_later opaque"></mat-icon>
            <input
              [ngModelOptions]="{ standalone: true }"
              [disabled]="visible"
              [(ngModel)]="hourDate"
              [ngxTimepicker]="min"
              matInput
              placeholder="HH/MM"
              readonly
              [min]="minHours"
              class="border-input mat-elevation-z1 border-radius"
            />
            <ngx-material-timepicker #min></ngx-material-timepicker>
          </div>
        </div>
      </div>
      <span *ngIf="showUndefinedDate" class="s-label">
        <mat-checkbox id="undefined-time" class="mr-1 mb-2" [ngModelOptions]="{ standalone: true }" [(ngModel)]="undefinedDate">
        </mat-checkbox>
        <label class="undefined-time" for="undefined-time"> Tiempo indefinido </label>
      </span>
      <div class="finish-date-range">
        <div class="finish-date">
          <label class="label-up-text mt-2" for="pickerF"> FECHA DE FINALIZACIÓN </label>
          <div class="mt-2 content-input">
            <mat-datepicker class="icon-date" touchUi #pickerF></mat-datepicker>
            <mat-datepicker-toggle class="icon-date" matSuffix [for]="pickerF"></mat-datepicker-toggle>
            <input
              matInput
              (click)="pickerF.open()"
              [matDatepicker]="pickerF"
              [min]="maxDate"
              readonly
              class="border-input mat-elevation-z1 border-radius"
              [disabled]="showUndefinedDate && (undefinedDate || visible)"
              (dateChange)="hourChange($event, 'finishDate')"
              [ngModelOptions]="{ standalone: true }"
              [(ngModel)]="dateFinishPublication"
              placeholder="DD/MM/AAAA"
            />
          </div>
        </div>
        <div class="ending-time">
          <label class="label-up-text mt-2"> HORA DE FINALIZACIÓN </label>
          <div class="mt-2 content-input">
            <mat-icon *ngIf="!showUndefinedDate || (!undefinedDate && !visible)" class="tio-watch_later"></mat-icon>
            <mat-icon *ngIf="showUndefinedDate && (undefinedDate || visible)" class="tio-watch_later opaque"></mat-icon>
            <input
              [ngModelOptions]="{ standalone: true }"
              [disabled]="showUndefinedDate && (undefinedDate || visible)"
              [(ngModel)]="hourDateFinish"
              [ngxTimepicker]="min2"
              matInput
              placeholder="HH/MM"
              readonly
              [min]="minHours"
              class="border-input mat-elevation-z1 border-radius"
            />
            <ngx-material-timepicker #min2></ngx-material-timepicker>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  
  
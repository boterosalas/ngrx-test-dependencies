<form
  class="register-container"
  [formGroup]="registerForm"
  *ngIf="showRegisterForm"
>
  <mat-form-field>
    <input
      matInput
      id="name"
      type="text"
      placeholder="{{ 'GENERIC.NAME' | translate }}"
      formControlName="name"
      required
    />
    <mat-error
      id="requiredName"
      *ngIf="
        registerForm.controls.name.invalid &&
        registerForm.controls.name.errors.required
      "
      >{{ "GENERIC.REQUIRED" | translate: { formValue: "Nombre" } }}</mat-error
    >

    <mat-error
      id="maxName"
      *ngIf="
        registerForm.controls.name.invalid &&
        registerForm.controls.name.errors.maxlength
      "
      >{{
        "GENERIC.MAX_CHARACTERS"
          | translate
            : {
                maxchar:
                  registerForm.controls.name.errors.maxlength.requiredLength
              }
      }}</mat-error
    >

    <mat-error
      id="invalidName"
      *ngIf="
        registerForm.controls.name.invalid &&
        registerForm.controls.name.errors.pattern
      "
      >{{ "GENERIC.INVALID_FORMAT" | translate: { val: "Nombre" } }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <input
      matInput
      id="lastname"
      type="text"
      placeholder="{{ 'GENERIC.LASTNAME' | translate }}"
      formControlName="lastName"
      required
    />
    <mat-error
      id="requiredLastName"
      *ngIf="
        registerForm.controls.lastName.invalid &&
        registerForm.controls.lastName.errors.required
      "
      >{{
        "GENERIC.REQUIRED" | translate: { formValue: "Apellidos" }
      }}</mat-error
    >

    <mat-error
      id="maxLastName"
      *ngIf="
        registerForm.controls.lastName.invalid &&
        registerForm.controls.lastName.errors.maxlength
      "
      >{{
        "GENERIC.MAX_CHARACTERS"
          | translate
            : {
                maxchar:
                  registerForm.controls.lastName.errors.maxlength.requiredLength
              }
      }}</mat-error
    >

    <mat-error
      id="invalidLastName"
      *ngIf="
        registerForm.controls.lastName.invalid &&
        registerForm.controls.lastName.errors.pattern
      "
      >{{
        "GENERIC.INVALID_FORMAT" | translate: { val: "Apellidos" }
      }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <mat-select
      placeholder="{{ 'REGISTER.ID_TYPE' | translate }}"
      id="idtype"
      formControlName="idType"
    >
      <mat-option>{{ "REGISTER.ID_TYPE" | translate }}</mat-option>
      <mat-option *ngFor="let typeId of idUserType" value="{{ typeId.id }}">{{
        typeId.value
      }}</mat-option>
    </mat-select>
    <mat-error
      id="requiredTypeId"
      *ngIf="registerForm.controls.idType.invalid"
      >{{ "GENERIC.REQUIRED" | translate: { formValue: "" } }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <input
      matInput
      id="id"
      type="text"
      placeholder="{{ 'GENERIC.DOCUMENT_NUMBER' | translate }}"
      formControlName="id"
      required
    />

    <mat-error
      id="reuiredId"
      *ngIf="
        registerForm.controls.id.invalid &&
        registerForm.controls.id.errors.required
      "
      >{{
        "GENERIC.REQUIRED" | translate: { formValue: "Número de documento" }
      }}</mat-error
    >

    <mat-error
      id="maxId"
      *ngIf="
        registerForm.controls.id.invalid &&
        registerForm.controls.id.errors.maxlength
      "
      >{{
        "GENERIC.MAX_CHARACTERS"
          | translate
            : {
                maxchar:
                  registerForm.controls.id.errors.maxlength.requiredLength
              }
      }}</mat-error
    >

    <mat-error
      id="numberId"
      *ngIf="
        registerForm.controls.id.invalid &&
        registerForm.controls.id.errors.pattern
      "
      >{{ "GENERIC.ONLY_NUMBERS" | translate }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <input
      matInput
      id="phone"
      type="text"
      placeholder="{{ 'GENERIC.CELLPHONE' | translate }}"
      formControlName="phone"
      required
    />
    <mat-error
      id="requiredPhone"
      *ngIf="
        registerForm.controls.phone.invalid &&
        registerForm.controls.phone.errors.required
      "
      >{{ "GENERIC.REQUIRED" | translate: { formValue: "Celular" } }}</mat-error
    >

    <mat-error
      id="minPhone"
      *ngIf="
        registerForm.controls.phone.invalid &&
        registerForm.controls.phone.errors.minlength
      "
      >{{
        "GENERIC.MIN_CHARACTERS"
          | translate
            : {
                minchar:
                  registerForm.controls.phone.errors.minlength.requiredLength
              }
      }}</mat-error
    >

    <mat-error
      id="maxPhone"
      *ngIf="
        registerForm.controls.phone.invalid &&
        registerForm.controls.phone.errors.maxlength
      "
      >{{
        "GENERIC.MAX_CHARACTERS"
          | translate
            : {
                maxchar:
                  registerForm.controls.phone.errors.maxlength.requiredLength
              }
      }}</mat-error
    >

    <mat-error
      id="numberPhone"
      *ngIf="
        registerForm.controls.phone.invalid &&
        registerForm.controls.phone.errors.pattern
      "
      >{{ "GENERIC.ONLY_NUMBERS" | translate }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <input
      matInput
      id="email"
      type="email"
      placeholder="{{ 'GENERIC.EMAIL' | translate }}"
      formControlName="email"
      spacebar
      required
    />
    <mat-error id="invalidEmail" *ngIf="registerForm.controls.email.invalid">{{
      "LOGIN.INVALID_EMAIL" | translate: { formValue: "Email" }
    }}</mat-error>
  </mat-form-field>

  <mat-form-field>
    <input
      matInput
      appBlockCopyPaste
      id="confirmEmail"
      type="email"
      placeholder="{{ 'GENERIC.CONFIRM_EMAIL' | translate }}"
      formControlName="confirmEmail"
      spacebar
      required
    />

    <mat-error
      id="patternEmail"
      *ngIf="registerForm.controls.confirmEmail.invalid"
      >{{ "GENERIC.CONFIRM_EMAIL_PATTERN" | translate }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <input
      matInput
      id="password"
      type="password"
      placeholder="{{ 'GENERIC.PASSWORD' | translate }}"
      formControlName="password"
      required
      spacebar
    />
    <mat-error
      id="requiredPassword"
      *ngIf="
        registerForm.controls.password.invalid &&
        registerForm.controls.password.errors.required
      "
      >{{
        "GENERIC.REQUIRED" | translate: { formValue: "Contraseña" }
      }}</mat-error
    >

    <mat-error
      id="minPassword"
      *ngIf="
        registerForm.controls.password.invalid &&
        registerForm.controls.password.errors.minlength
      "
      >{{
        "GENERIC.MIN_CHARACTERS"
          | translate
            : {
                minchar:
                  registerForm.controls.password.errors.minlength.requiredLength
              }
      }}</mat-error
    >

    <mat-error
      id="maxPassword"
      *ngIf="
        registerForm.controls.password.invalid &&
        registerForm.controls.password.errors.maxlength
      "
      >{{
        "GENERIC.MAX_CHARACTERS"
          | translate
            : {
                maxchar:
                  registerForm.controls.password.errors.maxlength.requiredLength
              }
      }}</mat-error
    >

    <mat-error
      id="patternPassword"
      *ngIf="
        registerForm.controls.password.invalid &&
        registerForm.controls.password.errors.pattern
      "
      >{{ "GENERIC.PASSWORD_PATTERN" | translate }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <input
      matInput
      id="confirmPassword"
      type="password"
      placeholder="{{ 'GENERIC.CONFIRM_PASSWORD' | translate }}"
      formControlName="confirmPassword"
      required
      spacebar
    />
    <mat-error
      id="notmatchPassword"
      *ngIf="
        registerForm.get('confirmPassword').errors &&
        registerForm.get('confirmPassword').errors.ConfirmPassword
      "
      >{{ "REGISTER.PASSWORD_NOT_MATCH" | translate }}</mat-error
    >

    <mat-error
      id="requiredConfirmPassword"
      *ngIf="
        registerForm.controls.confirmPassword.invalid &&
        registerForm.controls.confirmPassword.errors.required
      "
      >{{
        "GENERIC.REQUIRED" | translate: { formValue: "Contraseña" }
      }}</mat-error
    >

    <mat-error
      id="minConfirmPassword"
      *ngIf="
        registerForm.controls.confirmPassword.invalid &&
        registerForm.controls.confirmPassword.errors.minlength
      "
      >{{
        "GENERIC.MIN_CHARACTERS"
          | translate
            : {
                minchar:
                  registerForm.controls.confirmPassword.errors.minlength
                    .requiredLength
              }
      }}</mat-error
    >

    <mat-error
      id="maxConfirmPassword"
      *ngIf="
        registerForm.controls.confirmPassword.invalid &&
        registerForm.controls.confirmPassword.errors.maxlength
      "
      >{{
        "GENERIC.MAX_CHARACTERS"
          | translate
            : {
                maxchar:
                  registerForm.controls.confirmPassword.errors.maxlength
                    .requiredLength
              }
      }}</mat-error
    >
  </mat-form-field>

  <button
    mat-raised-button
    id="next"
    class="center button button-100 gtmRegistroClicInfSiguiente"
    color="orange"
    (click)="nextStep()"
    [disabled]="!registerForm.valid"
  >
    <span fxLayoutAlign="space-around center" class="gtmRegistroClicInfSiguiente">
      {{ "GENERIC.NEXT" | translate }} <mat-icon>arrow_forward</mat-icon>
    </span>
  </button>
</form>

<div *ngIf="showTerms">
  <h4>{{ "REGISTER.TITLE_SECTION" | translate }}</h4>
  <h3>{{ "REGISTER.TITLE_TERMS_AND_CONDITIONS" | translate }}</h3>
  <div class="terms">
    <div innerHtml="{{ 'TERMS.LEGAL' | translate }}"></div>
    <div innerHtml="{{ 'TERMS.PROTECTION' | translate }}"></div>
  </div>
  <mat-checkbox id="chkaccept" (change)="acceptTermsCheck()">{{
    "REGISTER.ACCEPT" | translate
  }}</mat-checkbox>
  <button
    mat-raised-button
    id="register"
    class="mt-2 center button button-100"
    color="orange"
    (click)="register()"
    [disabled]="!acceptTerms"
  >
    {{ "GENERIC.REGISTER" | translate }}
  </button>
</div>

<form
  autocomplete="nope"
  class="register-container"
  [formGroup]="externalForm"
  *ngIf="showRegisterFormExternal"
>
  <p class="additional-info">{{ "REGISTER.INFO_HOME" | translate }}</p>

  <mat-form-field>
    <input
      matInput
      id="departmentCode"
      placeholder="{{ 'REGISTER.DEPARTMENT' | translate }}"
      [matAutocomplete]="auto"
      formControlName="department"
      autocomplete="nope"
      (blur)="checkDepartment()"
    />
    <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayDepartment">
      <mat-option
        (onSelectionChange)="selectDepartment(department)"
        *ngFor="let department of filteredDepartments | async; let i = index"
        [value]="department"
      >
        <span>{{ department.description }}</span>
      </mat-option>
    </mat-autocomplete>

    <mat-error
      id="requiredDepartment"
      *ngIf="
        externalForm.controls.department.invalid &&
        externalForm.controls.department.errors.required
      "
      >{{
        "GENERIC.REQUIRED" | translate: { formValue: "Departamento" }
      }}</mat-error
    >
    <mat-error
      id="selectDepartementError"
      *ngIf="
        externalForm.controls.department.invalid &&
        externalForm.controls.department.errors.incorrect
      "
      >{{
        "REGISTER.ERROR_DEPARTMENT" | translate
      }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <input
      matInput
      id="city"
      placeholder="{{ 'REGISTER.CITY' | translate }}"
      [matAutocomplete]="city"
      formControlName="city"
      autocomplete="nope"
      (blur)="checkCity()"
    />
    <mat-autocomplete #city="matAutocomplete">
      <mat-option
        (onSelectionChange)="selectCity(city)"
        *ngFor="let city of filteredCities | async"
        [(value)]="city.description"
      >
        <span>{{ city.description }}</span>
      </mat-option>
    </mat-autocomplete>

    <mat-error
      id="selectCityError"
      *ngIf="
        externalForm.controls.city.invalid &&
        externalForm.controls.city.errors.incorrectCity
      "
      >{{
        "REGISTER.ERROR_CITY" | translate
      }}</mat-error>

    <mat-error
      id="requiredCity"
      *ngIf="
        externalForm.controls.city.invalid &&
        externalForm.controls.city.errors.required
      "
      >{{ "GENERIC.REQUIRED" | translate: { formValue: "Ciudad" } }}</mat-error
    >

    
  </mat-form-field>

  <mat-form-field>
    <input
      matInput
      id="address"
      type="text"
      placeholder="{{ 'REGISTER.ADDRESS' | translate }}"
      formControlName="address"
      autocomplete="nope"
    />

    <mat-error
      id="requiredAddress"
      *ngIf="
        externalForm.controls.address.invalid &&
        externalForm.controls.address.errors.required
      "
      >{{ "GENERIC.REQUIRED" | translate: { formValue: "Ciudad" } }}</mat-error
    >
  </mat-form-field>

  <p class="additional-info">{{ "REGISTER.ACOUNT_INFO" | translate }}</p>

  <mat-form-field>
    <mat-select
      placeholder="{{ 'REGISTER.BANK' | translate }}"
      id="bank"
      formControlName="bank"
    >
      <!-- <mat-option>{{ "REGISTER.BANK" | translate }}</mat-option> -->
      <mat-option *ngFor="let bank of banks" value="{{ bank.description }}">
        <span>{{ bank.description }}</span></mat-option
      >
    </mat-select>

    <mat-error
      id="requiredBank"
      *ngIf="
        externalForm.controls.bank.invalid &&
        externalForm.controls.bank.errors.required
      "
      >{{ "GENERIC.REQUIRED" | translate: { formValue: "Banco" } }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <mat-select
      placeholder="{{ 'REGISTER.TYPE_ACCOUNT' | translate }}"
      id="typeAccount"
      formControlName="typeAccount"
    >
      <mat-option *ngFor="let account of typeAccount" value="{{ account.id }}"
        ><span>{{ account.description }}</span></mat-option
      >
    </mat-select>

    <mat-error
      id="requiredTypeAccount"
      *ngIf="
        externalForm.controls.typeAccount.invalid &&
        externalForm.controls.typeAccount.errors.required
      "
      >{{
        "GENERIC.REQUIRED" | translate: { formValue: "Tipo de cuenta" }
      }}</mat-error
    >
  </mat-form-field>

  <mat-form-field>
    <input
      spacebar
      matInput
      id="numberAccount"
      type="text"
      placeholder="{{ 'REGISTER.NUMBER_ACCOUNT' | translate }}"
      formControlName="numberAccount"
    />

    <mat-error
      id="requiredTypeAccount"
      *ngIf="
        externalForm.controls.numberAccount.invalid &&
        externalForm.controls.numberAccount.errors.required
      "
      >{{
        "GENERIC.REQUIRED" | translate: { formValue: "Número de cuenta" }
      }}</mat-error
    >

    <mat-error
      id="invalidNumber"
      *ngIf="
        externalForm.controls.numberAccount.invalid &&
        externalForm.controls.numberAccount.errors.pattern
      "
      >{{ "GENERIC.ONLY_NUMBERS" | translate }}</mat-error
    >

    <mat-error
      id="minAccount"
      *ngIf="
        externalForm.controls.numberAccount.invalid &&
        externalForm.controls.numberAccount.errors.minlength
      "
      >{{
        "GENERIC.MIN_CHARACTERS"
          | translate
            : {
                minchar: externalForm.controls.numberAccount.errors.minlength.requiredLength
              }
      }}</mat-error
    >

    <mat-error
    id="maxAccount"
    *ngIf="
      externalForm.controls.numberAccount.invalid &&
      externalForm.controls.numberAccount.errors.maxlength
    "
    >{{
      "GENERIC.MAX_CHARACTERS"
        | translate
          : {
              maxchar: externalForm.controls.numberAccount.errors.maxlength.requiredLength
            }
    }}</mat-error
  >

  </mat-form-field>

  <p class="additional-info">{{ "REGISTER.ADITIONAL_FILE" | translate }}</p>

  <p>{{ "REGISTER.INFO_ADDITIONAL" | translate }}</p>
  <p class="black">
    <strong>{{ "REGISTER.INFO_ADDITIONAL_2" | translate }}</strong>
  </p>

  <div fxLayout="row" fxLayoutAlign="space-between center" class="pb-3">
    <div fxLayout="column" fxLayoutAlign="center">
      <strong class="gray">{{ "REGISTER.CED1" | translate }}</strong>
      <span *ngIf="nameFileCed1 === ''">No hay archivo seleccionado</span>
      <span class="file-input" *ngIf="nameFileCed1 !== ''">{{
        nameFileCed1 | truncate: '20'
      }}</span>
    </div>
    <div fxLayout="column" fxLayoutAlign="center">
      <label for="ced1" id="upload" class="cursor-pointer">
        <span *ngIf="!showErrorCed1">
        <img
          class="mt-1"
          *ngIf="nameFileCed1 === ''"
          src="/assets/img/image-file-upload.svg"
          alt="upload"
        />
        <img
          class="mt-1"
          *ngIf="nameFileCed1 !== ''"
          src="/assets/img/image-file-upload-ok.svg"
          alt="upload"
        />  
      </span>

      <img
      class="mt-1 w-icon"
      *ngIf="showErrorCed1"
      src="/assets/img/icono-error-carga.svg"
      alt="upload"
    />
      </label>
    </div>
  </div>

  <input
    (change)="onFileChange($event, 'ced1')"
    id="ced1"
    type="file"
    formControlName="ced1"
  />

  <mat-error *ngIf="showErrorCed1" class="small pb-2">
    {{ "GENERIC.INVALID_FORMAT_FILE_REGISTER" | translate }}
  </mat-error>

  <div fxLayout="row" fxLayoutAlign="space-between center" class="pb-3">
    <div fxLayout="column" fxLayoutAlign="center">
      <strong class="gray">{{ "REGISTER.CED2" | translate }}</strong>
      <span *ngIf="nameFileCed2 === ''">No hay archivo seleccionado</span>
      <span class="file-input" *ngIf="nameFileCed2 !== ''">{{
        nameFileCed2 | truncate: '20'
      }}</span>
    </div>
    <div fxLayout="column" fxLayoutAlign="center">
      <label for="ced2" id="upload" class="cursor-pointer">
        <span  *ngIf="!showErrorCed2">
        <img
          class="mt-1"
          *ngIf="nameFileCed2 === ''"
          src="/assets/img/image-file-upload.svg"
          alt="upload"
        />
        <img
          class="mt-1"
          *ngIf="nameFileCed2 !== ''"
          src="/assets/img/image-file-upload-ok.svg"
          alt="upload"
        />
      </span>
        <img
        class="mt-1 w-icon"
        *ngIf="showErrorCed2"
        src="/assets/img/icono-error-carga.svg"
        alt="upload"
      />
      </label>
    </div>
  </div>

  <input
    (change)="onFileChange($event, 'ced2')"
    id="ced2"
    type="file"
    formControlName="ced2"
  />
  <mat-error *ngIf="showErrorCed2" class="small pb-2">
    {{ "GENERIC.INVALID_FORMAT_FILE_REGISTER" | translate }}
  </mat-error>

  <div fxLayout="row" fxLayoutAlign="space-between center" class="pb-3">
    <div fxLayout="column" fxLayoutAlign="center">
      <strong class="gray">{{ "REGISTER.ACCOUNT_CERT" | translate }}</strong>
      <span *ngIf="nameFileCert === ''">No hay archivo seleccionado</span>
      <span class="file-input" *ngIf="nameFileCert !== ''">{{
        nameFileCert | truncate: '20'
      }}</span>
    </div>
    <div fxLayout="column" fxLayoutAlign="center">
      <label for="cert" id="upload" class="cursor-pointer">
        <span *ngIf="!showErrorCert">
        <img
          class="mt-1"
          *ngIf="nameFileCert === ''"
          src="/assets/img/image-file-upload.svg"
          alt="upload"
        />
        <img
          class="mt-1"
          *ngIf="nameFileCert !== ''"
          src="/assets/img/image-file-upload-ok.svg"
          alt="upload"
        />
      </span>
        <img
        class="mt-1 w-icon"
        *ngIf="showErrorCert"
        src="/assets/img/icono-error-carga.svg"
        alt="upload"
      />
      </label>
    </div>
  </div>

  <input
    (change)="onFileChange($event, 'cert')"
    id="cert"
    type="file"
    formControlName="cert"
  />

  <mat-error *ngIf="showErrorCert" class="small pb-2">
    {{ "GENERIC.INVALID_FORMAT_FILE_REGISTER" | translate }}
  </mat-error>

  <button
    mat-raised-button
    id="nextClicker"
    class="center button button-100 gtmRegistroClicInfSiguientePaso2"
    color="orange"
    (click)="nextStepExternalClicker()"
    [disabled]="!externalForm.valid || (showErrorCed1 || showErrorCed2 || showErrorCert)"
  >
    <span fxLayoutAlign="space-around center" class="gtmRegistroClicInfSiguientePaso2">
      {{ "GENERIC.NEXT" | translate }} <mat-icon>arrow_forward</mat-icon>
    </span>
  </button>
</form>
